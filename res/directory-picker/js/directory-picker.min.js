/**
 * Directory Picker jQuery Plugin
 * @author Voislav JovanoviÄ‡ <voislavj@gmail.com>
 */
function DirectoryPick(e,t){var n=$('<a class="directory-picker-trigger" href="javascript:void(0);">select</a>');n.click(function(){DirectoryPickShow(e,t)});e.after(n)}function DirectoryPickShow(e,t){var n=$('<div class="directory-picker-content" />');n.html("loading...");n.dialog({title:e.val(),modal:true,width:t.width,height:t.height,buttons:{Select:function(){var t=$(".directory-picker-content a.selected");if(t.length){var n=$(".directory-picker-content").attr("base")+"/"+t.attr("title");e.val(n);$(this).dialog("close")}},Cancel:function(){$(this).dialog("close")}}});var r=$('<input type="text" id="directory-picker-filter" />');r.keypress(function(){var e=$(this).attr("timeout");if(e){clearTimeout(e)}});r.keyup(function(e){$(this).attr("timeout",setTimeout(function(){var e=r.val();n.find("a").each(function(){if($(this).attr("title").indexOf(e)>=0){$(this).show()}else{$(this).hide()}})},800))});$(".ui-dialog-buttonpane").append('<label for="directory-picker-filter">Search:</label>');$(".ui-dialog-buttonpane").append(r);var i="";var s=e.val().replace(/\\/g,"/").split(/\//);if(e.val().length&&s.length>0){s.pop();i=s.join("/")}i=i.replace(/^"|#$/g,"");DirectoryPickLoad(i,t,e)}function DirectoryPickLoad(path,options,input){var content=$(".directory-picker-content");path=path.replace(/\/$/,"");$.ajax({url:options.script,type:"get",data:$.extend(options,{path:path}),beforeSend:function(){content.html("Loading...")},complete:function(req){if(req.status==200){var data=eval("("+req.responseText+")");var title=data.base;if(title.length>30){title="..."+title.substr(title.length-30)}$(".ui-dialog-title").html(title);content.attr("base",data.base);content.empty();var full,short;for(x in data.children){full=data.children[x].name;short=data.children[x].name;if(short.length>10){short=short.substr(0,10)+"..."}content.append('<a class="type-'+data.children[x].type+'" title="'+full+'" href="javascript:void(0)">'+short+"</a>")}content.children("a").click(function(){$(this).parent().children("a").removeClass("selected");$(this).addClass("selected")});content.children("a").dblclick(function(){if($(this).hasClass("type-dir")||$(this).hasClass("type-dir-up")){DirectoryPickLoad(data.base+"/"+$(this).attr("title"),options,input)}else{var e=content.attr("base")+"/"+$(this).attr("title");input.val(e);content.dialog("close")}})}else{content.html(req.status+". "+req.statusText)}}})}(function(){$.fn.extend({directory_picker:function(e){var e=$.extend(true,{path:"",width:400,height:240,script:null},e);if(e.script){DirectoryPick($(this),e)}}})})(jQuery)
